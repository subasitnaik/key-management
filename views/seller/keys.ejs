<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Manual Keys</title>
  <%- include('../partials/mobile-styles') %>
  <style>
    .key-display { background: #27272a; padding: 1rem; border-radius: 10px; font-family: monospace; margin-top: 1rem; word-break: break-all; font-size: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <%- include('../partials/seller-nav') %>
    <h1>Manual Key Generation</h1>
    <% if (typeof key !== 'undefined' && key) { %><p class="success">Key generated:</p><div class="key-display"><%= key %></div><% } %>
    <% if (typeof err !== 'undefined' && err === 'devices') { %><p class="error">Enter a valid number of devices (positive integer greater than 1)</p><% } %>
    <div class="card">
      <form method="post" action="/panel/seller/keys">
        <div class="form-group">
          <label>Max devices (how many devices can use this key at a time)</label>
          <select name="max_devices_mode" id="maxDevicesMode">
            <option value="1">1 device (unique key)</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="form-group" id="customDevicesWrap" style="display:none;">
          <label>Number of devices</label>
          <input type="number" name="max_devices_custom" id="maxDevicesCustom" min="2" placeholder="Enter a positive integer &gt; 1">
        </div>
        <div class="form-group">
          <label>Days</label>
          <select name="days">
            <% if (plans && plans.length) { plans.forEach(function(p) { %><option value="<%= p.days %>"><%= p.name %> (<%= p.days %> days)</option><% }); } else { %><option value="30">30 days</option><% } %>
          </select>
        </div>
        <div class="form-group">
          <label>Custom Key (optional - leave blank for auto)</label>
          <input type="text" name="custom_key" placeholder="Leave blank for random">
        </div>
        <button type="submit" class="btn btn-block">Generate Key</button>
      </form>
    </div>
  </div>
  <script>
    (function() {
      var mode = document.getElementById('maxDevicesMode');
      var wrap = document.getElementById('customDevicesWrap');
      var input = document.getElementById('maxDevicesCustom');
      function toggle() {
        var isCustom = mode.value === 'custom';
        wrap.style.display = isCustom ? 'block' : 'none';
        input.required = isCustom;
      }
      mode.addEventListener('change', toggle);
      toggle();
    })();
  </script>
</body>
</html>
