<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><%= seller ? 'Edit Seller' : 'New Seller' %></title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="header">
    <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-hidden="true">
    <label for="nav-toggle" class="hamburger" aria-label="Open menu"><span></span></label>
    <a href="/panel/admin/logout" class="header-logout">Logout</a>
    <nav class="nav-menu">
      <a href="/panel/admin">Dashboard</a>
      <a href="/panel/admin/sellers">Sellers</a>
      <a href="/panel/admin/settings">Settings</a>
    </nav>
    <label for="nav-toggle" class="nav-backdrop" aria-label="Close menu"></label>
  </header>
  <div class="page">
    <h1><%= seller ? 'Edit Seller' : 'New Seller' %></h1>
    <p><a href="/panel/admin/sellers" class="btn btn-secondary">Back</a></p>
    <% if (typeof error !== 'undefined' && error) { %>
    <div class="card error-msg" role="alert">
      <% if (error === 'missing') { %>Please fill Slug, Username and Password.<% }
         else if (error === 'duplicate') { %>Slug or Username already exists. Use different values.<% }
         else { %>Could not save. <%= typeof errorMessage !== 'undefined' && errorMessage ? errorMessage : 'Check slug/username are unique and try again.' %><% } %>
    </div>
    <% } %>
    <div class="card">
      <form method="post" action="<%= seller ? '/panel/admin/sellers/' + seller.id : '/panel/admin/sellers' %>">
        <% if (!seller) { %>
        <div class="form-group">
          <label>Slug</label>
          <input name="slug" type="text" required placeholder="e.g. test">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input name="password" type="password" required>
        </div>
        <% } %>
        <div class="form-group">
          <label>Username</label>
          <input name="username" type="text" value="<%= seller ? (seller.username || '') : '' %>" required>
        </div>
        <div class="form-group">
          <label>CCPU</label>
          <input name="ccpu" type="number" value="<%= seller ? (seller.ccpu || 30) : 30 %>" min="1">
        </div>
        <div class="form-group">
          <label>Telegram username</label>
          <input name="telegram_username" type="text" value="<%= seller ? (seller.telegram_username || '') : '' %>" placeholder="@username">
        </div>
        <div class="form-group">
          <label>Telegram bot token</label>
          <input name="telegram_bot_token" type="text" value="<%= seller ? (seller.telegram_bot_token || '') : '' %>" placeholder="optional">
        </div>
        <div class="form-group">
          <label><input name="query_channel_enabled" type="checkbox" <%= seller && seller.query_channel_enabled ? 'checked' : '' %>> Query channel enabled</label>
        </div>
        <div class="form-group">
          <label>Query group link</label>
          <input name="query_group_link" type="text" value="<%= seller ? (seller.query_group_link || '') : '' %>">
        </div>
        <div class="form-group">
          <label>Private group link</label>
          <input name="private_group_link" type="text" value="<%= seller ? (seller.private_group_link || '') : '' %>">
        </div>
        <button type="submit" class="btn">Save</button>
      </form>
    </div>
    <% if (seller) { %>
    <div class="card" id="credits">
      <h2>Credits</h2>
      <p>Current balance: <strong><%= seller.credits_balance ?? 0 %></strong></p>
      <% if (typeof creditsSuccess !== 'undefined' && creditsSuccess) { %>
      <p class="success-msg">Credits updated.</p>
      <% } %>
      <% if (typeof creditsError !== 'undefined' && creditsError) { %>
      <p class="error-msg-inline">Enter a valid amount (positive to add, negative to deduct).</p>
      <% } %>
      <form method="post" action="/panel/admin/sellers/<%= seller.id %>/credits" class="form-inline">
        <div class="form-group">
          <label>Amount</label>
          <input name="amount" type="number" placeholder="e.g. 10 or -5" required>
        </div>
        <div class="form-group">
          <label>Reason</label>
          <input name="reason" type="text" placeholder="Optional">
        </div>
        <button type="submit" class="btn">Adjust credits</button>
      </form>
    </div>
    <div class="card">
      <h2>Delete seller</h2>
      <p>This will suspend the seller. They will no longer appear in the list and cannot log in.</p>
      <form method="post" action="/panel/admin/sellers/<%= seller.id %>/delete" onsubmit="return confirm('Permanently delete (suspend) this seller?');">
        <button type="submit" class="btn btn-danger">Delete seller</button>
      </form>
    </div>
    <% } %>
  </div>
</body>
</html>
